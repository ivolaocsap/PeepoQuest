{"ast":null,"code":"import _createClass from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _regeneratorRuntime from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _inherits from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _wrapNativeSuper from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";/* eslint-disable @typescript-eslint/ban-types */import{AbstractConnector}from'@web3-react/abstract-connector';import invariant from'tiny-invariant';// taken from ethers.js, compatible interface with web3 provider\nexport var RequestError=/*#__PURE__*/function(_Error){_inherits(RequestError,_Error);var _super=_createSuper(RequestError);function RequestError(message,code,data){var _this;_classCallCheck(this,RequestError);_this=_super.call(this);_this.code=code;_this.data=data;_this.name=_this.constructor.name;_this.message=message;return _this;}return RequestError;}(/*#__PURE__*/_wrapNativeSuper(Error));var MiniRpcProvider=function MiniRpcProvider(chainId,url){var _this2=this;_classCallCheck(this,MiniRpcProvider);this.isMetaMask=false;this.chainId=void 0;this.url=void 0;this.host=void 0;this.path=void 0;this.sendAsync=function(request,callback){console.log('sendAsync',request.method,request.params);_this2.request(request.method,request.params).then(function(result){return callback(null,{jsonrpc:'2.0',id:request.id,result:result});}).catch(function(error){return callback(error,null);});};this.request=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(method,params){var response,body,_body$error,_body$error2,_body$error3;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(typeof method!=='string'){params=method.params;method=method.method;}_context.next=3;return fetch(_this2.url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',id:1,method:method,params:params})});case 3:response=_context.sent;if(response.ok){_context.next=6;break;}throw new RequestError(\"\".concat(response.status,\": \").concat(response.statusText),-32000);case 6:_context.next=8;return response.json();case 8:body=_context.sent;if(!('error'in body)){_context.next=13;break;}throw new RequestError(body===null||body===void 0?void 0:(_body$error=body.error)===null||_body$error===void 0?void 0:_body$error.message,body===null||body===void 0?void 0:(_body$error2=body.error)===null||_body$error2===void 0?void 0:_body$error2.code,body===null||body===void 0?void 0:(_body$error3=body.error)===null||_body$error3===void 0?void 0:_body$error3.data);case 13:if(!('result'in body)){_context.next=17;break;}return _context.abrupt(\"return\",body.result);case 17:throw new RequestError(\"Received unexpected JSON-RPC response to \".concat(method,\" request.\"),-32000,body);case 18:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();this.chainId=chainId;this.url=url;var parsed=new URL(url);this.host=parsed.host;this.path=parsed.pathname;};export var NetworkConnector=/*#__PURE__*/function(_AbstractConnector){_inherits(NetworkConnector,_AbstractConnector);var _super2=_createSuper(NetworkConnector);function NetworkConnector(_ref2){var _this3;var urls=_ref2.urls,defaultChainId=_ref2.defaultChainId;_classCallCheck(this,NetworkConnector);invariant(defaultChainId||Object.keys(urls).length===1,'defaultChainId is a required argument with >1 url');_this3=_super2.call(this,{supportedChainIds:Object.keys(urls).map(function(k){return Number(k);})});_this3.providers=void 0;_this3.currentChainId=void 0;_this3.currentChainId=defaultChainId||Number(Object.keys(urls)[0]);_this3.providers=Object.keys(urls).reduce(function(accumulator,chainId){accumulator[Number(chainId)]=new MiniRpcProvider(Number(chainId),urls[Number(chainId)]);return accumulator;},{});return _this3;}_createClass(NetworkConnector,[{key:\"activate\",value:function(){var _activate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",{provider:this.providers[this.currentChainId],chainId:this.currentChainId,account:null});case 1:case\"end\":return _context2.stop();}}},_callee2,this);}));function activate(){return _activate.apply(this,arguments);}return activate;}()},{key:\"getProvider\",value:function(){var _getProvider=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",this.providers[this.currentChainId]);case 1:case\"end\":return _context3.stop();}}},_callee3,this);}));function getProvider(){return _getProvider.apply(this,arguments);}return getProvider;}()},{key:\"getChainId\",value:function(){var _getChainId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",this.currentChainId);case 1:case\"end\":return _context4.stop();}}},_callee4,this);}));function getChainId(){return _getChainId.apply(this,arguments);}return getChainId;}()},{key:\"getAccount\",value:function(){var _getAccount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",null);case 1:case\"end\":return _context5.stop();}}},_callee5);}));function getAccount(){return _getAccount.apply(this,arguments);}return getAccount;}()},{key:\"deactivate\",value:function deactivate(){return;}},{key:\"changeChainId\",value:function changeChainId(chainId){invariant(Object.keys(this.providers).includes(chainId.toString()),\"No url found for chainId \".concat(chainId));this.currentChainId=chainId;this.emitUpdate({provider:this.providers[this.currentChainId],chainId:chainId});}}]);return NetworkConnector;}(AbstractConnector);","map":{"version":3,"sources":["/Users/ivopascoal/Desktop/cuffies/src/libs/NetworkConnector.ts"],"names":["AbstractConnector","invariant","RequestError","message","code","data","name","constructor","Error","MiniRpcProvider","chainId","url","isMetaMask","host","path","sendAsync","request","callback","console","log","method","params","then","result","jsonrpc","id","catch","error","fetch","headers","body","JSON","stringify","response","ok","status","statusText","json","parsed","URL","pathname","NetworkConnector","urls","defaultChainId","Object","keys","length","supportedChainIds","map","k","Number","providers","currentChainId","reduce","accumulator","provider","account","includes","toString","emitUpdate"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/ban-types */\nimport { ConnectorUpdate } from '@web3-react/types';\nimport { AbstractConnector } from '@web3-react/abstract-connector';\nimport invariant from 'tiny-invariant';\n\n// taken from ethers.js, compatible interface with web3 provider\ntype AsyncSendable = {\n  isMetaMask?: boolean;\n  host?: string;\n  path?: string;\n  sendAsync?: (request: any, callback: (error: any, response: any) => void) => void;\n  send?: (request: any, callback: (error: any, response: any) => void) => void;\n};\n\nexport class RequestError extends Error {\n  constructor(message: string, public code: number, public data?: unknown) {\n    super();\n    this.name = this.constructor.name;\n    this.message = message;\n  }\n}\n\nclass MiniRpcProvider implements AsyncSendable {\n  public readonly isMetaMask: false = false;\n  public readonly chainId: number;\n  public readonly url: string;\n  public readonly host: string;\n  public readonly path: string;\n\n  constructor(chainId: number, url: string) {\n    this.chainId = chainId;\n    this.url = url;\n    const parsed = new URL(url);\n    this.host = parsed.host;\n    this.path = parsed.pathname;\n  }\n\n  public readonly sendAsync = (\n    request: {\n      jsonrpc: '2.0';\n      id: number | string | null;\n      method: string;\n      params?: unknown[] | object;\n    },\n    callback: (error: any, response: any) => void,\n  ): void => {\n    console.log('sendAsync', request.method, request.params);\n    this.request(request.method, request.params)\n      .then((result) => callback(null, { jsonrpc: '2.0', id: request.id, result }))\n      .catch((error) => callback(error, null));\n  };\n\n  public readonly request = async (\n    method: string | { method: string; params?: unknown[] | object },\n    params?: unknown[] | object,\n  ): Promise<unknown> => {\n    if (typeof method !== 'string') {\n      params = (method as any).params;\n      method = method.method;\n    }\n\n    const response = await fetch(this.url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        jsonrpc: '2.0',\n        id: 1,\n        method,\n        params,\n      }),\n    });\n    if (!response.ok)\n      throw new RequestError(`${response.status}: ${response.statusText}`, -32000);\n    const body = await response.json();\n    if ('error' in body) {\n      throw new RequestError(body?.error?.message, body?.error?.code, body?.error?.data);\n    } else if ('result' in body) {\n      return body.result;\n    } else {\n      throw new RequestError(\n        `Received unexpected JSON-RPC response to ${method} request.`,\n        -32000,\n        body,\n      );\n    }\n  };\n}\n\ninterface NetworkConnectorArguments {\n  urls: { [chainId: number]: string };\n  defaultChainId?: number;\n}\n\nexport class NetworkConnector extends AbstractConnector {\n  private readonly providers: { [chainId: number]: MiniRpcProvider };\n  private currentChainId: number;\n\n  constructor({ urls, defaultChainId }: NetworkConnectorArguments) {\n    invariant(\n      defaultChainId || Object.keys(urls).length === 1,\n      'defaultChainId is a required argument with >1 url',\n    );\n    super({ supportedChainIds: Object.keys(urls).map((k): number => Number(k)) });\n\n    this.currentChainId = defaultChainId || Number(Object.keys(urls)[0]);\n    this.providers = Object.keys(urls).reduce<{ [chainId: number]: MiniRpcProvider }>(\n      (accumulator, chainId) => {\n        accumulator[Number(chainId)] = new MiniRpcProvider(\n          Number(chainId),\n          urls[Number(chainId)],\n        );\n        return accumulator;\n      },\n      {},\n    );\n  }\n\n  public async activate(): Promise<ConnectorUpdate> {\n    return {\n      provider: this.providers[this.currentChainId],\n      chainId: this.currentChainId,\n      account: null,\n    };\n  }\n\n  public async getProvider(): Promise<MiniRpcProvider> {\n    return this.providers[this.currentChainId];\n  }\n\n  public async getChainId(): Promise<number> {\n    return this.currentChainId;\n  }\n\n  public async getAccount(): Promise<null> {\n    return null;\n  }\n\n  public deactivate() {\n    return;\n  }\n\n  public changeChainId(chainId: number) {\n    invariant(\n      Object.keys(this.providers).includes(chainId.toString()),\n      `No url found for chainId ${chainId}`,\n    );\n    this.currentChainId = chainId;\n    this.emitUpdate({ provider: this.providers[this.currentChainId], chainId });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}