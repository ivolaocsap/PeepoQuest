{"ast":null,"code":"import _classCallCheck from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _assertThisInitialized from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _regeneratorRuntime from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{Contract}from'@ethersproject/contracts';import{defineReadOnly}from'@ethersproject/properties';function buildSafeCall(contract,signature,fragment){if(fragment.constant){// keep view function as is\nreturn function(){return contract[signature].apply(contract,arguments);};}return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _contract$estimateGas;var _len,args,_key,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:for(_len=_args.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=_args[_key];}return _context.abrupt(\"return\",(_contract$estimateGas=contract.estimateGas)[signature].apply(_contract$estimateGas,args).then(function(){return contract[signature].apply(contract,args);}).catch(function(estimateError){var _estimateError$data,_estimateError$data$m;if((estimateError===null||estimateError===void 0?void 0:estimateError.code)===-32603&&(estimateError===null||estimateError===void 0?void 0:(_estimateError$data=estimateError.data)===null||_estimateError$data===void 0?void 0:(_estimateError$data$m=_estimateError$data.message)===null||_estimateError$data$m===void 0?void 0:_estimateError$data$m.includes('always failing transaction'))){var _contract$callStatic;// extract real error code\nreturn(_contract$callStatic=contract.callStatic)[signature].apply(_contract$callStatic,args).then(function(){console.log('????');}).catch(function(callError){throw callError;});}throw estimateError;}));case 2:case\"end\":return _context.stop();}}},_callee);}));}export var BinanceContract=/*#__PURE__*/function(_Contract){_inherits(BinanceContract,_Contract);var _super=_createSuper(BinanceContract);function BinanceContract(addressOrName,contractInterface,signerOrProvider){var _this;_classCallCheck(this,BinanceContract);_this=_super.call(this,addressOrName,contractInterface,signerOrProvider);_this.signerOrProvider=signerOrProvider;_this.safeCall={};Object.keys(_this.interface.functions).forEach(function(signature){var fragment=_this.interface.functions[signature];defineReadOnly(_this.safeCall,fragment.name,buildSafeCall(_assertThisInitialized(_this),signature,fragment));});return _this;}return BinanceContract;}(Contract);","map":{"version":3,"sources":["/Users/ivopascoal/Desktop/cuffies/src/diamondhand/BinanceContract.ts"],"names":["Contract","defineReadOnly","buildSafeCall","contract","signature","fragment","constant","args","estimateGas","then","catch","estimateError","code","data","message","includes","callStatic","console","log","callError","BinanceContract","addressOrName","contractInterface","signerOrProvider","safeCall","Object","keys","interface","functions","forEach","name"],"mappings":"i5BAAA,OAASA,QAAT,KAA8D,0BAA9D,CAGA,OAASC,cAAT,KAA+B,2BAA/B,CAGA,QAASC,CAAAA,aAAT,CAAuBC,QAAvB,CAA2CC,SAA3C,CAA8DC,QAA9D,CAA0F,CACxF,GAAIA,QAAQ,CAACC,QAAb,CAAuB,CACrB;AACA,MAAO,kBAAkBH,CAAAA,QAAQ,CAACC,SAAD,CAAR,OAAAD,QAAQ,WAA1B,EAAP,CACD,CACD,2EAAO,sNAAUI,IAAV,0CAAUA,IAAV,oDACE,uBAAAJ,QAAQ,CAACK,WAAT,EAAqBJ,SAArB,8BAAmCG,IAAnC,EACJE,IADI,CACC,iBAAMN,CAAAA,QAAQ,CAACC,SAAD,CAAR,OAAAD,QAAQ,CAAeI,IAAf,CAAd,EADD,EAEJG,KAFI,CAEE,SAACC,aAAD,CAAmB,+CACxB,GACE,CAAAA,aAAa,OAAb,EAAAA,aAAa,SAAb,QAAAA,aAAa,CAAEC,IAAf,IAAwB,CAAC,KAAzB,GACAD,aADA,SACAA,aADA,sCACAA,aAAa,CAAEE,IADf,qEACA,oBAAqBC,OADrB,gDACA,sBAA8BC,QAA9B,CAAuC,4BAAvC,CADA,CADF,CAGE,0BACA;AACA,MAAO,sBAAAZ,QAAQ,CAACa,UAAT,EAAoBZ,SAApB,6BAAkCG,IAAlC,EACJE,IADI,CACC,UAAM,CACVQ,OAAO,CAACC,GAAR,CAAY,MAAZ,EACD,CAHI,EAIJR,KAJI,CAIE,SAACS,SAAD,CAAe,CACpB,KAAMA,CAAAA,SAAN,CACD,CANI,CAAP,CAOD,CACD,KAAMR,CAAAA,aAAN,CACD,CAjBI,CADF,wDAAP,GAoBD,CAED,UAAaS,CAAAA,eAAb,gHAGE,yBACEC,aADF,CAEEC,iBAFF,CAGYC,gBAHZ,CAIE,iDACA,uBAAMF,aAAN,CAAqBC,iBAArB,CAAwCC,gBAAxC,EADA,MADUA,gBACV,CADUA,gBACV,OANFC,QAME,CAN2C,EAM3C,CAEAC,MAAM,CAACC,IAAP,CAAY,MAAKC,SAAL,CAAeC,SAA3B,EAAsCC,OAAtC,CAA8C,SAACzB,SAAD,CAAe,CAC3D,GAAMC,CAAAA,QAAQ,CAAG,MAAKsB,SAAL,CAAeC,SAAf,CAAyBxB,SAAzB,CAAjB,CACAH,cAAc,CAAC,MAAKuB,QAAN,CAAgBnB,QAAQ,CAACyB,IAAzB,CAA+B5B,aAAa,+BAAOE,SAAP,CAAkBC,QAAlB,CAA5C,CAAd,CACD,CAHD,EAFA,aAMD,CAbH,yBAAqCL,QAArC","sourcesContent":["import { Contract, ContractFunction, ContractInterface } from '@ethersproject/contracts';\nimport { Signer } from '@ethersproject/abstract-signer';\nimport { Provider } from '@ethersproject/providers';\nimport { defineReadOnly } from '@ethersproject/properties';\nimport { FunctionFragment } from '@ethersproject/abi';\n\nfunction buildSafeCall(contract: Contract, signature: string, fragment: FunctionFragment) {\n  if (fragment.constant) {\n    // keep view function as is\n    return (...args: any) => contract[signature](...args);\n  }\n  return async (...args: any[]) => {\n    return contract.estimateGas[signature](...args)\n      .then(() => contract[signature](...args))\n      .catch((estimateError) => {\n        if (\n          estimateError?.code === -32603 &&\n          estimateError?.data?.message?.includes('always failing transaction')\n        ) {\n          // extract real error code\n          return contract.callStatic[signature](...args)\n            .then(() => {\n              console.log('????');\n            })\n            .catch((callError) => {\n              throw callError;\n            });\n        }\n        throw estimateError;\n      });\n  };\n}\n\nexport class BinanceContract extends Contract {\n  safeCall: Record<string, ContractFunction> = {};\n\n  constructor(\n    addressOrName: string,\n    contractInterface: ContractInterface,\n    protected signerOrProvider?: Signer | Provider,\n  ) {\n    super(addressOrName, contractInterface, signerOrProvider);\n    Object.keys(this.interface.functions).forEach((signature) => {\n      const fragment = this.interface.functions[signature];\n      defineReadOnly(this.safeCall, fragment.name, buildSafeCall(this, signature, fragment));\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}