{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useCallback,useEffect,useMemo,useState}from'react';import{BigNumber}from'@ethersproject/bignumber';import useDiamondHand from'src/hooks/useDiamondHand';import useMyTicket from'src/hooks/useMyTicket';import useRoundInfo from'./useRoundInfo';import useHandleTransactionReceipt from'src/hooks/useHandleTransactionReceipt';import useMyTicketNumber from'src/hooks/useMyTicketNumber';import useTicketClaim from'./useTicketClaim';var countMatch=function countMatch(a,b){return a.filter(function(x){return b.includes(x);}).length;};var prizeIndex=function prizeIndex(x){return{jackpot:0,match4:1,match3:2,lost:undefined}[x];};var useMyRoundTicket=function useMyRoundTicket(roundId){var dh=useDiamondHand();var handleTransactionReceipt=useHandleTransactionReceipt();var myTicket=useMyTicket(roundId);var tickets=useMyTicketNumber(myTicket);var lotteryInfo=useRoundInfo(roundId);var _useState=useState(),_useState2=_slicedToArray(_useState,2),filteredTickets=_useState2[0],setFilteredTickets=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),claimable=_useState4[0],setClaimable=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),totalClaimable=_useState6[0],setTotalClaimable=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),winCount=_useState8[0],setWinCount=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loadingClaim=_useState12[0],setLoadingClaim=_useState12[1];var validTicket=useMemo(function(){if(!filteredTickets)return[];var jackpotIds=filteredTickets.jackpot.map(function(t){return t.id;});var match3Ids=filteredTickets.match3.map(function(t){return t.id;});var match4Ids=filteredTickets.match4.map(function(t){return t.id;});return jackpotIds.concat(match4Ids).concat(match3Ids);},[filteredTickets]);var _useTicketClaim=useTicketClaim(validTicket),claimStatuses=_useTicketClaim.claimStatuses,isCanClaimReward=_useTicketClaim.isCanClaimReward,getTicketClaimStatus=_useTicketClaim.getTicketClaimStatus;var calculatePrize=useCallback(function(ticket){if(!(lotteryInfo===null||lotteryInfo===void 0?void 0:lotteryInfo.winningNumbers)||!ticket){return;}var size=lotteryInfo===null||lotteryInfo===void 0?void 0:lotteryInfo.winningNumbers.length;var pbMatch=ticket[size-1]===(lotteryInfo===null||lotteryInfo===void 0?void 0:lotteryInfo.winningNumbers[size-1]);var match=countMatch(ticket.slice(0,size-1),lotteryInfo===null||lotteryInfo===void 0?void 0:lotteryInfo.winningNumbers.slice(0,size-1));if(match===4&&pbMatch){return 5;}return match;},[lotteryInfo===null||lotteryInfo===void 0?void 0:lotteryInfo.winningNumbers]);var calculateClaimable=useCallback(function(numberOfTickets,level){var _lotteryInfo$winners$;if(!(lotteryInfo===null||lotteryInfo===void 0?void 0:lotteryInfo.winners)){return BigNumber.from(0);}var index=prizeIndex(level);if(typeof index==='undefined'||((_lotteryInfo$winners$=lotteryInfo.winners[index])===null||_lotteryInfo$winners$===void 0?void 0:_lotteryInfo$winners$.eq(0))){return BigNumber.from(0);}return lotteryInfo===null||lotteryInfo===void 0?void 0:lotteryInfo.prizes[index].mul(numberOfTickets).div(lotteryInfo.winners[index]);},[lotteryInfo===null||lotteryInfo===void 0?void 0:lotteryInfo.prizes,lotteryInfo===null||lotteryInfo===void 0?void 0:lotteryInfo.winners]);useEffect(function(){setLoading(true);if(!tickets){return;}var filtered={jackpot:[],match4:[],match3:[],lost:[]};tickets.forEach(function(item){var match=calculatePrize(item.numbers);switch(match){case 5:return filtered.jackpot.push(item);case 4:return filtered.match4.push(item);case 3:return filtered.match3.push(item);default:filtered.lost.push(item);}});var claimableAmounts={};var total=BigNumber.from(0);Object.entries(filtered).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),level=_ref2[0],tickets=_ref2[1];var amount=calculateClaimable(tickets.length,level);claimableAmounts[level]=amount;total=total.add(amount);});setFilteredTickets(filtered);setClaimable(claimableAmounts);setTotalClaimable(total);setWinCount(tickets.length-filtered.lost.length);setLoading(false);},[calculateClaimable,calculatePrize,tickets]);var winNumbers=useMemo(function(){if(!lotteryInfo)return[];return lotteryInfo.winningNumbers.slice(0,4);},[lotteryInfo]);var powerBall=useMemo(function(){if(!lotteryInfo)return null;return lotteryInfo.winningNumbers[4];},[lotteryInfo]);var claimReward=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var tickets,tx;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!dh||!roundId||!filteredTickets)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:tickets=[].concat(_toConsumableArray(filteredTickets.jackpot.map(function(t){return t.id;})),_toConsumableArray(filteredTickets.match4.map(function(t){return t.id;})),_toConsumableArray(filteredTickets.match3.map(function(t){return t.id;})));if(tickets.length){_context.next=5;break;}return _context.abrupt(\"return\");case 5:setLoadingClaim(true);_context.prev=6;_context.next=9;return handleTransactionReceipt(dh.LOTTERY.batchClaimRewards(BigNumber.from(roundId),tickets),\"Claim reward\");case 9:tx=_context.sent;if(!(tx&&tx.response)){_context.next=16;break;}_context.next=13;return tx.response.wait();case 13:setLoadingClaim(false);getTicketClaimStatus();tx.hideModal();case 16:_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](6);setLoadingClaim(false);case 21:case\"end\":return _context.stop();}}},_callee,null,[[6,18]]);})),[dh,roundId,filteredTickets,handleTransactionReceipt,getTicketClaimStatus]);return{claimStatuses:claimStatuses,filteredTickets:filteredTickets,claimable:claimable,totalClaimable:totalClaimable,claimReward:claimReward,winCount:winCount,winNumbers:winNumbers,powerBall:powerBall,isCanClaimReward:isCanClaimReward,loading:loading,loadingClaim:loadingClaim};};export default useMyRoundTicket;","map":{"version":3,"sources":["/Users/ivopascoal/Desktop/cuffies/src/views/TicketDetail/hooks/useMyRoundTicket.ts"],"names":["useCallback","useEffect","useMemo","useState","BigNumber","useDiamondHand","useMyTicket","useRoundInfo","useHandleTransactionReceipt","useMyTicketNumber","useTicketClaim","countMatch","a","b","filter","x","includes","length","prizeIndex","jackpot","match4","match3","lost","undefined","useMyRoundTicket","roundId","dh","handleTransactionReceipt","myTicket","tickets","lotteryInfo","filteredTickets","setFilteredTickets","claimable","setClaimable","totalClaimable","setTotalClaimable","winCount","setWinCount","loading","setLoading","loadingClaim","setLoadingClaim","validTicket","jackpotIds","map","t","id","match3Ids","match4Ids","concat","claimStatuses","isCanClaimReward","getTicketClaimStatus","calculatePrize","ticket","winningNumbers","size","pbMatch","match","slice","calculateClaimable","numberOfTickets","level","winners","from","index","eq","prizes","mul","div","filtered","forEach","item","numbers","push","claimableAmounts","total","Object","entries","amount","add","winNumbers","powerBall","claimReward","LOTTERY","batchClaimRewards","tx","response","wait","hideModal"],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useMemo, useState } from 'react';\nimport { BigNumber } from '@ethersproject/bignumber';\nimport useDiamondHand from 'src/hooks/useDiamondHand';\nimport useMyTicket from 'src/hooks/useMyTicket';\nimport useRoundInfo from './useRoundInfo';\nimport useHandleTransactionReceipt from 'src/hooks/useHandleTransactionReceipt';\nimport useMyTicketNumber, { Ticket } from 'src/hooks/useMyTicketNumber';\nimport useTicketClaim from './useTicketClaim';\n\nconst countMatch = (a: number[], b: number[]) => {\n  return a.filter((x) => b.includes(x)).length;\n};\n\ntype Level = 'jackpot' | 'match4' | 'match3' | 'lost';\n\nconst prizeIndex = (x: Level): number => {\n  return {\n    jackpot: 0,\n    match4: 1,\n    match3: 2,\n    lost: undefined,\n  }[x];\n};\n\nconst useMyRoundTicket = (roundId?: number) => {\n  const dh = useDiamondHand();\n  const handleTransactionReceipt = useHandleTransactionReceipt();\n  const myTicket = useMyTicket(roundId);\n  const tickets = useMyTicketNumber(myTicket);\n  const lotteryInfo = useRoundInfo(roundId);\n  const [filteredTickets, setFilteredTickets] = useState<Record<Level, Ticket[]>>();\n  const [claimable, setClaimable] = useState<Record<Level, BigNumber>>();\n  const [totalClaimable, setTotalClaimable] = useState<BigNumber>();\n  const [winCount, setWinCount] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [loadingClaim, setLoadingClaim] = useState(false);\n\n  const validTicket = useMemo(() => {\n    if (!filteredTickets) return [];\n    const jackpotIds = filteredTickets.jackpot.map((t) => t.id);\n    const match3Ids = filteredTickets.match3.map((t) => t.id);\n    const match4Ids = filteredTickets.match4.map((t) => t.id);\n    return jackpotIds.concat(match4Ids).concat(match3Ids);\n  }, [filteredTickets]);\n\n  const { claimStatuses, isCanClaimReward, getTicketClaimStatus } = useTicketClaim(validTicket);\n\n  const calculatePrize = useCallback(\n    (ticket: number[]) => {\n      if (!lotteryInfo?.winningNumbers || !ticket) {\n        return;\n      }\n      const size = lotteryInfo?.winningNumbers.length;\n      const pbMatch = ticket[size - 1] === lotteryInfo?.winningNumbers[size - 1];\n      const match = countMatch(\n        ticket.slice(0, size - 1),\n        lotteryInfo?.winningNumbers.slice(0, size - 1),\n      );\n\n      if (match === 4 && pbMatch) {\n        return 5;\n      }\n\n      return match;\n    },\n    [lotteryInfo?.winningNumbers],\n  );\n\n  const calculateClaimable = useCallback(\n    (numberOfTickets: number, level: Level) => {\n      if (!lotteryInfo?.winners) {\n        return BigNumber.from(0);\n      }\n      const index = prizeIndex(level);\n      if (typeof index === 'undefined' || lotteryInfo.winners[index]?.eq(0)) {\n        return BigNumber.from(0);\n      }\n      return lotteryInfo?.prizes[index].mul(numberOfTickets).div(lotteryInfo.winners[index]);\n    },\n    [lotteryInfo?.prizes, lotteryInfo?.winners],\n  );\n\n  useEffect(() => {\n    setLoading(true);\n    if (!tickets) {\n      return;\n    }\n    const filtered = {\n      jackpot: [],\n      match4: [],\n      match3: [],\n      lost: [],\n    } as Record<string, Ticket[]>;\n    tickets.forEach((item) => {\n      const match = calculatePrize(item.numbers);\n      switch (match) {\n        case 5:\n          return filtered.jackpot.push(item);\n\n        case 4:\n          return filtered.match4.push(item);\n\n        case 3:\n          return filtered.match3.push(item);\n\n        default:\n          filtered.lost.push(item);\n      }\n    });\n\n    const claimableAmounts = {} as Record<Level, BigNumber>;\n    let total = BigNumber.from(0);\n    Object.entries(filtered).forEach(([level, tickets]) => {\n      const amount = calculateClaimable(tickets.length, level as Level);\n      claimableAmounts[level as Level] = amount;\n      total = total.add(amount);\n    });\n\n    setFilteredTickets(filtered as any);\n    setClaimable(claimableAmounts);\n    setTotalClaimable(total);\n    setWinCount(tickets.length - filtered.lost.length);\n    setLoading(false);\n  }, [calculateClaimable, calculatePrize, tickets]);\n\n  const winNumbers = useMemo(() => {\n    if (!lotteryInfo) return [];\n    return lotteryInfo.winningNumbers.slice(0, 4);\n  }, [lotteryInfo]);\n\n  const powerBall = useMemo(() => {\n    if (!lotteryInfo) return null;\n    return lotteryInfo.winningNumbers[4];\n  }, [lotteryInfo]);\n\n  const claimReward = useCallback(async () => {\n    if (!dh || !roundId || !filteredTickets) return;\n\n    const tickets = [\n      ...filteredTickets.jackpot.map((t) => t.id),\n      ...filteredTickets.match4.map((t) => t.id),\n      ...filteredTickets.match3.map((t) => t.id),\n    ];\n    if (!tickets.length) {\n      return;\n    }\n    setLoadingClaim(true);\n\n    try {\n      const tx = await handleTransactionReceipt(\n        dh.LOTTERY.batchClaimRewards(BigNumber.from(roundId), tickets),\n        `Claim reward`,\n      );\n\n      if (tx && tx.response) {\n        await tx.response.wait();\n        setLoadingClaim(false);\n        getTicketClaimStatus();\n        tx.hideModal();\n      }\n    } catch {\n      setLoadingClaim(false);\n    }\n  }, [dh, roundId, filteredTickets, handleTransactionReceipt, getTicketClaimStatus]);\n\n  return {\n    claimStatuses,\n    filteredTickets,\n    claimable,\n    totalClaimable,\n    claimReward,\n    winCount,\n    winNumbers,\n    powerBall,\n    isCanClaimReward,\n    loading,\n    loadingClaim,\n  };\n};\n\nexport default useMyRoundTicket;\n"]},"metadata":{},"sourceType":"module"}