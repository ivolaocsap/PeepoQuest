{"ast":null,"code":"import _taggedTemplateLiteral from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _slicedToArray from\"/Users/ivopascoal/Desktop/cuffies/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";var _templateObject,_templateObject2,_templateObject3;import React,{forwardRef,useCallback,useImperativeHandle,useMemo,useState}from'react';import styled from'styled-components';import{useTokenBalance}from'../../contexts/AccountBalanceProvider/AccountBalanceProvider';import useDiamondHand from'../../hooks/useDiamondHand';import{getDisplayNumber,parseNumber}from'../../utils/formatBN';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var TokenInput=function TokenInput(_ref,ref){var token=_ref.token,hasError=_ref.hasError,disabled=_ref.disabled,decimals=_ref.decimals,precision=_ref.precision,onChange=_ref.onChange,_ref$max=_ref.max,max=_ref$max===void 0?1e9:_ref$max,maxBalance=_ref.maxBalance,value=_ref.value;var _useState=useState(value?getDisplayNumber(value,decimals):''),_useState2=_slicedToArray(_useState,2),input=_useState2[0],setInput=_useState2[1];var _balance=useTokenBalance(token);var diamondHand=useDiamondHand();var balance=useMemo(function(){if(maxBalance){return maxBalance;}return _balance;},[maxBalance,_balance]);var patchInputValue=useCallback(function(newValue){var newInput='';try{newInput=getDisplayNumber(newValue,decimals,precision,false,false,false,false);}catch(e){newInput='';}setInput(newInput||'');return newInput;},[decimals,precision]);useImperativeHandle(ref,function(){return{resetInput:patchInputValue};},[patchInputValue]);var onInputChange=function onInputChange(event){var _value=event.target.value;broadcast(_value);};var broadcast=function broadcast(_value){if(!isInputValid(_value)){return false;}if(!isNaN(+_value)){setInput(_value);var parsedValue=parseNumber(_value,decimals,precision);onChange(parsedValue);}};var isInputValid=function isInputValid(inputValue){var _splits$;if(isNaN(+inputValue)){return false;}if(inputValue===undefined){return false;}var splits=inputValue.split('.');var countDecimals=((_splits$=splits[1])===null||_splits$===void 0?void 0:_splits$.length)||0;if(countDecimals>precision){return false;}if(+inputValue>max){return false;}return true;};var onMax=function onMax(){patchInputValue(balance);onChange(balance);};return/*#__PURE__*/_jsxs(StyledTokenInputWrapper,{children:[/*#__PURE__*/_jsx(StyledTokenInput,{hasError:hasError,disabled:disabled,type:\"text\",pattern:\"^[0-9]*[.,]?[0-9]*$\",placeholder:disabled?'-':'0.0',minLength:1,maxLength:79,spellCheck:false,inputMode:\"decimal\",onChange:function onChange(e){return onInputChange(e);},value:input}),!disabled&&(diamondHand===null||diamondHand===void 0?void 0:diamondHand.isUnlocked)&&/*#__PURE__*/_jsx(StyledButtonMax,{onClick:onMax,children:\"MAX\"})]});};var StyledTokenInputWrapper=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-flow: row nowrap;\\n  align-items: center;\\n  margin-right: 10px;\\n  flex: 1;\\n\"])));var StyledTokenInput=styled.input(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  color: \",\";\\n  width: 0px;\\n  position: relative;\\n  outline: none;\\n  border: none;\\n  flex: 1 1 auto;\\n  background-color: transparent;\\n  font-size: 32px;\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  padding: 0px;\\n  appearance: textfield;\\n  font-family: \",\";\\n  font-weight: bold;\\n\"])),function(_ref2){var theme=_ref2.theme,hasError=_ref2.hasError;return hasError?theme.color.red[500]:theme.color.primary.light;},function(_ref3){var theme=_ref3.theme;return theme.font.monospace;});var StyledButtonMax=styled.button(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  appearance: none;\\n  border: solid 2px \",\";\\n  background-color: #fcdcf2;\\n  color: \",\";\\n  font-size: 0.85rem;\\n  padding: 3px 8px;\\n  cursor: pointer;\\n  transition: ease-in-out 100ms;\\n  font-family: \",\";\\n  font-weight: bold;\\n  &:hover {\\n    background-color: \",\";\\n  }\\n\"])),function(props){return props.theme.color.primary.main;},function(props){return props.theme.color.primary.light;},function(_ref4){var theme=_ref4.theme;return theme.font.monospace;},function(props){return props.theme.color.primary.main;});export default/*#__PURE__*/forwardRef(TokenInput);","map":{"version":3,"sources":["/Users/ivopascoal/Desktop/cuffies/src/components/TokenInput/TokenInput.tsx"],"names":["React","forwardRef","useCallback","useImperativeHandle","useMemo","useState","styled","useTokenBalance","useDiamondHand","getDisplayNumber","parseNumber","TokenInput","ref","token","hasError","disabled","decimals","precision","onChange","max","maxBalance","value","input","setInput","_balance","diamondHand","balance","patchInputValue","newValue","newInput","e","resetInput","onInputChange","event","_value","target","broadcast","isInputValid","isNaN","parsedValue","inputValue","undefined","splits","split","countDecimals","length","onMax","isUnlocked","StyledTokenInputWrapper","div","StyledTokenInput","theme","color","red","primary","light","font","monospace","StyledButtonMax","button","props","main"],"mappings":"sXACA,MAAOA,CAAAA,KAAP,EAAgBC,UAAhB,CAA4BC,WAA5B,CAAyCC,mBAAzC,CAA8DC,OAA9D,CAAuEC,QAAvE,KAAuF,OAAvF,CACA,MAAOC,CAAAA,MAAP,KAAmB,mBAAnB,CACA,OAASC,eAAT,KAAgC,8DAAhC,CACA,MAAOC,CAAAA,cAAP,KAA2B,4BAA3B,CAEA,OAASC,gBAAT,CAA2BC,WAA3B,KAA8C,sBAA9C,C,wFAeA,GAAMC,CAAAA,UAAoE,CAAG,QAAvEA,CAAAA,UAAuE,MAE3EC,GAF2E,CAGxE,IAFDC,CAAAA,KAEC,MAFDA,KAEC,CAFMC,QAEN,MAFMA,QAEN,CAFgBC,QAEhB,MAFgBA,QAEhB,CAF0BC,QAE1B,MAF0BA,QAE1B,CAFoCC,SAEpC,MAFoCA,SAEpC,CAF+CC,QAE/C,MAF+CA,QAE/C,eAFyDC,GAEzD,CAFyDA,GAEzD,mBAF+D,GAE/D,UAFoEC,UAEpE,MAFoEA,UAEpE,CAFgFC,KAEhF,MAFgFA,KAEhF,CACH,cAA0BhB,QAAQ,CAASgB,KAAK,CAAGZ,gBAAgB,CAACY,KAAD,CAAQL,QAAR,CAAnB,CAAuC,EAArD,CAAlC,wCAAOM,KAAP,eAAcC,QAAd,eACA,GAAMC,CAAAA,QAAQ,CAAGjB,eAAe,CAACM,KAAD,CAAhC,CACA,GAAMY,CAAAA,WAAW,CAAGjB,cAAc,EAAlC,CACA,GAAMkB,CAAAA,OAAO,CAAGtB,OAAO,CAAC,UAAM,CAC5B,GAAIgB,UAAJ,CAAgB,CACd,MAAOA,CAAAA,UAAP,CACD,CAED,MAAOI,CAAAA,QAAP,CACD,CANsB,CAMpB,CAACJ,UAAD,CAAaI,QAAb,CANoB,CAAvB,CAQA,GAAMG,CAAAA,eAAe,CAAGzB,WAAW,CACjC,SAAC0B,QAAD,CAAyB,CACvB,GAAIC,CAAAA,QAAQ,CAAG,EAAf,CACA,GAAI,CACFA,QAAQ,CAAGpB,gBAAgB,CAACmB,QAAD,CAAWZ,QAAX,CAAqBC,SAArB,CAAgC,KAAhC,CAAuC,KAAvC,CAA8C,KAA9C,CAAqD,KAArD,CAA3B,CACD,CAAC,MAAOa,CAAP,CAAU,CACVD,QAAQ,CAAG,EAAX,CACD,CACDN,QAAQ,CAACM,QAAQ,EAAI,EAAb,CAAR,CACA,MAAOA,CAAAA,QAAP,CACD,CAVgC,CAWjC,CAACb,QAAD,CAAWC,SAAX,CAXiC,CAAnC,CAcAd,mBAAmB,CACjBS,GADiB,CAEjB,iBAAO,CACLmB,UAAU,CAAEJ,eADP,CAAP,EAFiB,CAKjB,CAACA,eAAD,CALiB,CAAnB,CAQA,GAAMK,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,KAAD,CAA8C,CAClE,GAAMC,CAAAA,MAAM,CAAID,KAAK,CAACE,MAAP,CAAmCd,KAAlD,CACAe,SAAS,CAACF,MAAD,CAAT,CACD,CAHD,CAKA,GAAME,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAACF,MAAD,CAAoB,CACpC,GAAI,CAACG,YAAY,CAACH,MAAD,CAAjB,CAA2B,CACzB,MAAO,MAAP,CACD,CACD,GAAI,CAACI,KAAK,CAAC,CAACJ,MAAF,CAAV,CAAqB,CACnBX,QAAQ,CAACW,MAAD,CAAR,CACA,GAAMK,CAAAA,WAAW,CAAG7B,WAAW,CAACwB,MAAD,CAASlB,QAAT,CAAmBC,SAAnB,CAA/B,CACAC,QAAQ,CAACqB,WAAD,CAAR,CACD,CACF,CATD,CAWA,GAAMF,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACG,UAAD,CAAwB,cAC3C,GAAIF,KAAK,CAAC,CAACE,UAAF,CAAT,CAAwB,CACtB,MAAO,MAAP,CACD,CACD,GAAIA,UAAU,GAAKC,SAAnB,CAA8B,CAC5B,MAAO,MAAP,CACD,CACD,GAAMC,CAAAA,MAAM,CAAGF,UAAU,CAACG,KAAX,CAAiB,GAAjB,CAAf,CACA,GAAMC,CAAAA,aAAa,CAAG,WAAAF,MAAM,CAAC,CAAD,CAAN,4CAAWG,MAAX,GAAqB,CAA3C,CACA,GAAID,aAAa,CAAG3B,SAApB,CAA+B,CAC7B,MAAO,MAAP,CACD,CACD,GAAI,CAACuB,UAAD,CAAcrB,GAAlB,CAAuB,CACrB,MAAO,MAAP,CACD,CACD,MAAO,KAAP,CACD,CAhBD,CAkBA,GAAM2B,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,EAAM,CAClBnB,eAAe,CAACD,OAAD,CAAf,CACAR,QAAQ,CAACQ,OAAD,CAAR,CACD,CAHD,CAKA,mBACE,MAAC,uBAAD,yBACE,KAAC,gBAAD,EACE,QAAQ,CAAEZ,QADZ,CAEE,QAAQ,CAAEC,QAFZ,CAGE,IAAI,CAAC,MAHP,CAIE,OAAO,CAAC,qBAJV,CAKE,WAAW,CAAEA,QAAQ,CAAG,GAAH,CAAS,KALhC,CAME,SAAS,CAAE,CANb,CAOE,SAAS,CAAE,EAPb,CAQE,UAAU,CAAE,KARd,CASE,SAAS,CAAC,SATZ,CAUE,QAAQ,CAAE,kBAACe,CAAD,QAAOE,CAAAA,aAAa,CAACF,CAAD,CAApB,EAVZ,CAWE,KAAK,CAAER,KAXT,EADF,CAcG,CAACP,QAAD,GAAaU,WAAb,SAAaA,WAAb,iBAAaA,WAAW,CAAEsB,UAA1B,gBACC,KAAC,eAAD,EAAiB,OAAO,CAAED,KAA1B,iBAfJ,GADF,CAoBD,CAhGD,CAkGA,GAAME,CAAAA,uBAAuB,CAAG1C,MAAM,CAAC2C,GAAV,0KAA7B,CAQA,GAAMC,CAAAA,gBAAgB,CAAG5C,MAAM,CAACgB,KAAV,qYACX,mBAAG6B,CAAAA,KAAH,OAAGA,KAAH,CAAUrC,QAAV,OAAUA,QAAV,OACPA,CAAAA,QAAQ,CAAGqC,KAAK,CAACC,KAAN,CAAYC,GAAZ,CAAgB,GAAhB,CAAH,CAA0BF,KAAK,CAACC,KAAN,CAAYE,OAAZ,CAAoBC,KAD/C,EADW,CAeL,mBAAGJ,CAAAA,KAAH,OAAGA,KAAH,OAAeA,CAAAA,KAAK,CAACK,IAAN,CAAWC,SAA1B,EAfK,CAAtB,CAmBA,GAAMC,CAAAA,eAAe,CAAGpD,MAAM,CAACqD,MAAV,4VAEC,SAACC,KAAD,QAAWA,CAAAA,KAAK,CAACT,KAAN,CAAYC,KAAZ,CAAkBE,OAAlB,CAA0BO,IAArC,EAFD,CAIV,SAACD,KAAD,QAAWA,CAAAA,KAAK,CAACT,KAAN,CAAYC,KAAZ,CAAkBE,OAAlB,CAA0BC,KAArC,EAJU,CASJ,mBAAGJ,CAAAA,KAAH,OAAGA,KAAH,OAAeA,CAAAA,KAAK,CAACK,IAAN,CAAWC,SAA1B,EATI,CAYG,SAACG,KAAD,QAAWA,CAAAA,KAAK,CAACT,KAAN,CAAYC,KAAZ,CAAkBE,OAAlB,CAA0BO,IAArC,EAZH,CAArB,CAgBA,2BAAe5D,UAAU,CAACU,UAAD,CAAzB","sourcesContent":["import { BigNumber } from '@ethersproject/bignumber';\nimport React, { forwardRef, useCallback, useImperativeHandle, useMemo, useState } from 'react';\nimport styled from 'styled-components';\nimport { useTokenBalance } from '../../contexts/AccountBalanceProvider/AccountBalanceProvider';\nimport useDiamondHand from '../../hooks/useDiamondHand';\nimport ERC20 from '../../diamondhand/ERC20';\nimport { getDisplayNumber, parseNumber } from '../../utils/formatBN';\n\ninterface TokenInputProps {\n  token: ERC20;\n  decimals?: number;\n  precision?: number;\n  disabled?: boolean;\n  hasError?: boolean;\n  onMax?: () => void;\n  onChange?: (value: BigNumber) => void;\n  max?: number;\n  maxBalance?: BigNumber;\n  value?: BigNumber;\n}\n\nconst TokenInput: React.ForwardRefRenderFunction<unknown, TokenInputProps> = (\n  { token, hasError, disabled, decimals, precision, onChange, max = 1e9, maxBalance, value },\n  ref,\n) => {\n  const [input, setInput] = useState<string>(value ? getDisplayNumber(value, decimals) : '');\n  const _balance = useTokenBalance(token);\n  const diamondHand = useDiamondHand();\n  const balance = useMemo(() => {\n    if (maxBalance) {\n      return maxBalance;\n    }\n\n    return _balance;\n  }, [maxBalance, _balance]);\n\n  const patchInputValue = useCallback(\n    (newValue: BigNumber) => {\n      let newInput = '';\n      try {\n        newInput = getDisplayNumber(newValue, decimals, precision, false, false, false, false);\n      } catch (e) {\n        newInput = '';\n      }\n      setInput(newInput || '');\n      return newInput;\n    },\n    [decimals, precision],\n  );\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      resetInput: patchInputValue,\n    }),\n    [patchInputValue],\n  );\n\n  const onInputChange = (event: React.FormEvent<HTMLInputElement>) => {\n    const _value = (event.target as HTMLInputElement).value;\n    broadcast(_value);\n  };\n\n  const broadcast = (_value: string) => {\n    if (!isInputValid(_value)) {\n      return false;\n    }\n    if (!isNaN(+_value)) {\n      setInput(_value);\n      const parsedValue = parseNumber(_value, decimals, precision);\n      onChange(parsedValue);\n    }\n  };\n\n  const isInputValid = (inputValue: string) => {\n    if (isNaN(+inputValue)) {\n      return false;\n    }\n    if (inputValue === undefined) {\n      return false;\n    }\n    const splits = inputValue.split('.');\n    const countDecimals = splits[1]?.length || 0;\n    if (countDecimals > precision) {\n      return false;\n    }\n    if (+inputValue > max) {\n      return false;\n    }\n    return true;\n  };\n\n  const onMax = () => {\n    patchInputValue(balance);\n    onChange(balance);\n  };\n\n  return (\n    <StyledTokenInputWrapper>\n      <StyledTokenInput\n        hasError={hasError}\n        disabled={disabled}\n        type=\"text\"\n        pattern=\"^[0-9]*[.,]?[0-9]*$\"\n        placeholder={disabled ? '-' : '0.0'}\n        minLength={1}\n        maxLength={79}\n        spellCheck={false}\n        inputMode=\"decimal\"\n        onChange={(e) => onInputChange(e)}\n        value={input}\n      ></StyledTokenInput>\n      {!disabled && diamondHand?.isUnlocked && (\n        <StyledButtonMax onClick={onMax}>MAX</StyledButtonMax>\n      )}\n    </StyledTokenInputWrapper>\n  );\n};\n\nconst StyledTokenInputWrapper = styled.div`\n  display: flex;\n  flex-flow: row nowrap;\n  align-items: center;\n  margin-right: 10px;\n  flex: 1;\n`;\n\nconst StyledTokenInput = styled.input<{ hasError?: boolean }>`\n  color: ${({ theme, hasError }) =>\n    hasError ? theme.color.red[500] : theme.color.primary.light};\n  width: 0px;\n  position: relative;\n  outline: none;\n  border: none;\n  flex: 1 1 auto;\n  background-color: transparent;\n  font-size: 32px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding: 0px;\n  appearance: textfield;\n  font-family: ${({ theme }) => theme.font.monospace};\n  font-weight: bold;\n`;\n\nconst StyledButtonMax = styled.button`\n  appearance: none;\n  border: solid 2px ${(props) => props.theme.color.primary.main};\n  background-color: #fcdcf2;\n  color: ${(props) => props.theme.color.primary.light};\n  font-size: 0.85rem;\n  padding: 3px 8px;\n  cursor: pointer;\n  transition: ease-in-out 100ms;\n  font-family: ${({ theme }) => theme.font.monospace};\n  font-weight: bold;\n  &:hover {\n    background-color: ${(props) => props.theme.color.primary.main};\n  }\n`;\n\nexport default forwardRef(TokenInput);\n"]},"metadata":{},"sourceType":"module"}